package com.satishlabs.service;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Service;
import com.satishlabs.util.TraceUtil;

@Service
public class ServerLoggingService {

    private final Logger logger = LoggerFactory.getLogger(ServerLoggingService.class);

    public enum LogLevel {
        EMERG, ALERT, CRIT, ERROR, WARNING, NOTICE, INFO, DEBUG
    }

    public void log(LogLevel level, String message, Object additional) {
        String traceId = TraceUtil.getCurrentTraceId();
        String spanId = TraceUtil.getCurrentSpanId();

        /*Object maskedObj = DataMaskingUtils.maskData(additional);
        String masked;
        try {
            masked = new ObjectMapper().writeValueAsString(maskedObj);
        } catch (com.fasterxml.jackson.core.JsonProcessingException e) {
            masked = "Error serializing masked data: " + e.getMessage();
        }*/

        String log = String.format(
                "trace_id=%s, span_id=%s, message=%s",
                traceId, spanId, message);

        switch (level) {
            case EMERG:
            case ALERT:
            case CRIT:
                logger.error(log);
                break;
            case ERROR:
                logger.error(log);
                break;
            case WARNING:
                logger.warn(log);
                break;
            case NOTICE:
            case INFO:
                logger.info(log);
                break;
            case DEBUG:
                logger.debug(log);
                break;
        }
    }
}
